<%@ page language="java" contentType="text/html; charset=UTF-8"    pageEncoding="UTF-8"%><!DOCTYPE><html><head><meta charset=utf-8><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta http-equiv="pragma" content="no-cache"><meta http-equiv="cache-control" content="no-cache"><meta http-equiv="expires" content="0"><script type="text/javascript" src="./js/ip.js"></script><!-- 在线地图API --><script type="text/javascript"	src="http://api.map.baidu.com/library/AreaRestriction/1.2/src/AreaRestriction_min.js"></script><script type="text/javascript"	src="http://api.map.baidu.com/api?v=2.0&ak=5eaf319004051778e962d47c4e46bb78"></script>	<!-- <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css"> -->  	<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>	<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script><!-- 离线地图API --><!-- <script type="text/javascript" src="./baidumapv2/baidumap_offline_v2_load.js"></script><link rel="stylesheet" type="text/css" href="./baidumapv2/css/baidu_map_v2.css"/> --><script src="./js/jquery-1.8.1.min.js" ></script><title>多车监控</title></head><body><!-- <div style="height: 5%; border:#ccc solid 1px;font-size:14px" class="maneger-Monitor-AllCar-top">	<ul style="width: 50%;height: 100%; list-style:none;">		<li><span>行驶</span><div style="width: 10px; height: 10px; background-color: red; border: #ccc solid 1px; position: relative;top:2px; left: 10px;"></div></li>		<li style="float: left;"><a href="#">行驶</a><span style="width: 150px; height: 10px; background-color: red;border: #ccc solid 1px;"></span></li>		<li style="float: left;"><a href="#">行驶</a></li>		<li style="float: left;"><a href="#">行驶</a></li>		<li style="float: left;"><a href="#">行驶</a></li>			</ul></div> --> <div style="height: 100%;border:#ccc solid 1px;font-size:12px" id="map"></div> <%--<div style="height: 50%; width:80%; border:#ccc solid 1px;font-size:12px" class="manager-Monitor-AllCar-bottom"> <ul class="nav nav-pills">  <li class="active"><a href="#">报警记录</a></li>  <li><a href="#">超速报警</a></li>  <li><a href="#">低压报警</a></li></ul> 	<table class="table">	<thead>		<tr>			<th><span><input type="checkbox"></span>&nbsp;&nbsp;车牌号</th>			<th>驾驶员</th>			<th>异常类型</th>			<th>报警时间</th>			<th>报警地点</th>		</tr>	</thead>	<tbody>		<tr class="active">			<td><span><input type="checkbox"></span>&nbsp;&nbsp;车牌号</td>			<td>23/11/2013</td>			<td>待发货</td>			<td>待发货</td>			<td>待发货</td>		</tr>		<tr>		<td>		<div class="manage-staff-work-end">                <div class="manage-staff-work-page">                            第 ${page.pageNow} 页   ;   共 ${page.totalPageCount} 页   &nbsp;	                    	<a id="first" href="#" style="width:50px">首页</a>&nbsp;	                        <a id="last" href="#" style="width:50px">上一页</a>&nbsp;	                        <a id="next" href="#" style="width:50px">下一页</a>&nbsp;	                        <a id="end" href="#" style="width:50px">尾页</a>                </div>            </div>		</td>		</tr>	</tbody></table> </div> --%></body><script type="text/javascript">/* var new_element=document.createElement("script");new_element.setAttribute("type","text/javascript");new_element.setAttribute("src","./js/ip.js");// 在这里引入了a.jsdocument.body.appendChild(new_element); */	var str;	var url = window.location.search;	if (url.indexOf("?") != -1) {		str = url.substr(1);	}	var map,marker,lable,carMarket;	var adds;	var s = new Array();		map = new BMap.Map("map");	map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);	map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放	map.addControl(new BMap.NavigationControl());   //缩放按钮	//var webSocket =  new WebSocket('ws://localhost:8080/motorcadeWeb/websocket');	//var webSocket =  new WebSocket('ws://'+IP+':8090/motorcadeWeb/websocket');	var webSocket =  new WebSocket('ws://115.29.109.21:8090/motorcadeWeb/websocket');		webSocket.onerror = function(event) {			onError(event);		};		webSocket.onopen = function(event) {			onOpen(event);		};		webSocket.onmessage = function(event) {			onMessage(event);		};		function onOpen(event) {			webSocket.send(str);		}		function onError(event) {			alert(event.data);		}		function onMessage(event) {			map.clearOverlays();			adds = new Array();			cars = new Array();		    s = eval(event.data);			for( var i = 0; i < s.length; i++)			{				adds[i] = new BMap.Point(s[i].longitude,s[i].latitude);				lable = s[i].plateNumber+"<p hidden>"+s[i].sn+"</p>";							addMarker(adds[i],lable,s[i].state);			}						map.panTo(adds[0]);						function addMarker(point,lable,online)			{				if(online == 0 || online == 3)					{						carMarket = new BMap.Marker(point,{icon : new BMap.Icon("./img/caroff.png",							new BMap.Size(28, 40), {						imageOffset : new BMap.Size(0, 0)						})						});					}				else if(online == 1 || online == 2)					{						carMarket = new BMap.Marker(point,{icon : new BMap.Icon("./img/car.png",							new BMap.Size(28, 40), {						imageOffset : new BMap.Size(0, 0)						})						});					}				carMarket.setTop(true);				map.addOverlay(carMarket); 				var label = new BMap.Label(lable, {					offset : new BMap.Size(-8, -25)				});				carMarket.setLabel(label);							carMarket.addEventListener("click",function()						{														var p = this.getLabel();       //获取marker的位置   							var m = p.getContent();							var n = m.split("<p hidden>");							var sn = n[1].substr(0,n[1].length-4);							parent.clickSingle(sn);						});				carMarket.addEventListener("mouseover",function()						{					carMarket.setTop(true,27000000);						});				carMarket.addEventListener("mouseout",function()						{					carMarket.setTop(false); 						});			}		}						</script></html>